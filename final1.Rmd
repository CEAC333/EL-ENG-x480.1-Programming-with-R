---
title: "Programming with R: Final Exam"
author: "Heather Savoy"
date: "10/04/2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This PDF describes the problem statement for the first problem for our final exam. Write one .R script (or, optionally, a .Rmd) that addresses the problem described below. Upload your script to Question 1 of the **Final Exam (Timed)** assignment.  


## Problem 1
This problem focuses on determining if there is a difference in the occurence of insomnia between male and female genders. The data we will use is from the Bureau of Labor Statistics which conducts the American Time Use Survey (you can read more about it at <https://www.bls.gov/tus/>). I've uploaded the relevant survey file to Canvas (*Files/Example Data Sets/attusum.dat*). There is a lot of data in the file where the rows are survey participants and the columns represent activities they do (e.g. sleeping, cooking, watching tv, etc.). The numbers in the dataframe represent how many minutes the survey participant spends on average doing those things per day. To answer our question about gender disparity for insomnia, we are only interested in two columns:

* `TESEX`, which represents gender and takes on the value of 1 for male and 2 for female
* `t010102`, which represents the activity of sleeplessness

Even though the file extension is .dat, it is a comma-delimited file and you can use the `read.csv` function to read the information into a dataframe. The tricky part is how to translate that data into an additional column of the logical data type indicating if the person suffers from insomnia. For example, once you read in the file and subset it to the two relevant columns, the beginning of your dataframe will look like this:

```{r, echo = FALSE}
atussum <- read.csv("~/Downloads/atussum_2016/atussum_2016.dat")
sleep <- data.frame(TESEX=as.factor(atussum$TESEX), t010102=atussum$t010102)
head(sleep)
```

but you will want to add an additional column like so:

```{r, echo = FALSE}
sleep$insomnia <- sleep$t010102 > 20
head(sleep)
```

Here, all the minutes of sleeplessness are 0, so these first few participants don't have insomnia. So what is the minimum number of minutes of sleeplessness that we should categorize as insomnia? There's no universal quantitative definition like that, so we will try many values and see how it affects our analysis. That analysis will be a Chi-Square test for independence. We can use the `chisq.test` function to conduct the test to see if the two categorical variables (i.e. gender and insomnia) are independent. The null hypothesis for this test is that the two variables are independent (i.e. no gender disparity for insomnia). We can extract the p-value from the result of `chisq.test` and store that with the current definition of insomnia. For example, you can use a for loop to generate a dataframe like this:

```{r, echo=FALSE}
library(ggplot2)
atussum <- read.csv("./Documents/UCBX Programming with R/Last/atussum_2016.dat")
sleep <- data.frame(gender=as.factor(atussum$TESEX), minutes=atussum$t010102)
insomnia <- seq(10,120,length.out=500)
psomnia <- data.frame()
for(tol in insomnia){
  sleep$insomnia <- sleep$minutes > tol
  pv <- chisq.test(sleep$insomnia, sleep$gender)$p.value
  psomnia <- rbind(psomnia, data.frame(tol,pv))
}
```


```{r, echo=FALSE}
head(psomnia)
```

where the *tol* column represents the sleeplessness tolerance to define insomnia (more minutes of sleeplessness than this value means the participant has insomnia) and the *pv* column is the p-value from the hypothesis test based on that tolerance. With this dataframe, you can create this figure:

```{r, echo = FALSE}
ggplot(psomnia,aes(tol,pv, color=pv<0.05)) + geom_line() +
  scale_color_discrete(labels=c("No",
                             "Yes"),
                             name = "Significant") +
  ylab("Chi-Square Independence Test P-value") +
  xlab("Insomnia Definition Minimum (minutes)") +
  labs(title = "Gender Disparity for Insomnia Depending on Definiton",
       caption = "Source: Bureau of Labor Statistics' American Time Use Survey 2016")

```

The plot indicates that if insomnia is defined as at least 60 minutes of sleeplessness per night, then we can conclude from this survey that there is a statistial difference between the occurence of insomnia for females and males that participated in this survey. **Write a script to re-create this figure**. Here is a quick recap:

* Since there isn't really a universal definition of insomnia, you will want to try different minimum minutes to define insomnia in this scenario. For example, you could loop over values between 10-120 minutes. 
* To conclude if there is a statistical difference in the occurence of insomnia between males and females, we need to create a column to represent if the person meets our insomnia criteria mentioned in the bullet above. 
* Using the insomnia column and the gender column, we can use the `chisq.test` function to conduct the test to see if the two categorical variables are dependent on eachother. The null hypothesis for this test is that the two variables are independent. 
* Once you complete the hypothesis test for each of your thresholds from the first bullet point, you can create the plot above. Indicate on the plot with color which p-values are less than the customary 5% significance level. Include descriptive axes and legend labels.




